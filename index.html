<!doctype html>
<html>
    <script type="text/javascript">
        // 为了疫情期间减少社区工作者和返乡人的麻烦，项目紧急赶出来的。SK不加密了，账号新注册的，也不重要。
        window._AMapSecurityConfig = {
            securityJsCode: 'a3df14ce5d268c07b7e73b0ddb2e88b8',
        }
    </script>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <style>
    html,
    body,
    #container {
      width: 100%;
      height: 100%;
    }
    </style>
    <title>杭州封控，管控，防范区查询</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
    <link rel="stylesheet" href="https://cache.amap.com/lbs/static/main1119.css"/>
    <script src="https://webapi.amap.com/maps?v=2.0&key=e0522f33cb490d99ecf1e3a59dbf1316&plugin=AMap.PolygonEditor"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
</head>
<body>
<div id="container"></div>
<div id="myPageTop">
    <table>
        <tr>
            <td>
                <label>请输入您在杭州位置关键词：</label>
            </td>
        </tr>
        <tr>
            <td>
                <input id="tipinput"/>
            </td>
        </tr>
    </table>
</div>
<div class="input-card" style="width: 120px">
    <button class="btn" onclick="createPolygon(0)" style="margin-bottom: 5px">新建封控</button>
    <button class="btn" onclick="createPolygon(1)" style="margin-bottom: 5px">新建管控</button>
    <button class="btn" onclick="createPolygon(2)" style="margin-bottom: 5px">新建防范</button>
    <button class="btn" onclick="closeEditor()">结束编辑</button>
    <button class="btn" onclick="printPaths()">打印坐标</button>
</div>
<script type="text/javascript">
    alert("本系统仅供参考，以政府通告为准! 以楼/号为单位的区，本系统可能会忽略。(数据最后更新：2021-01-31 22:28)");
    if (window.location.search.indexOf("edit=1") == -1) {
        document.querySelector(".input-card").remove();
    }
    var map = new AMap.Map("container", {
        center: [120.190451, 30.189531],
        zoom: 15.2,
    });

    //输入提示
    var autoOptions = {
        input: "tipinput"
    };
     AMap.plugin(['AMap.PlaceSearch','AMap.AutoComplete'], function(){
        var auto = new AMap.AutoComplete(autoOptions);
        var placeSearch = new AMap.PlaceSearch({
            map: map
        });  //构造地点查询类
        auto.on("select", select);//注册监听，当选中某条记录时会触发
        function select(e) {
            placeSearch.setCity(e.poi.adcode);
            placeSearch.search(e.poi.name);  //关键字查询查询
        }
    });

    // !!!!!!!!!!
    // 点击“打印坐标”后，把console中输出的内容复制到这，完成数据更新。
    var p1Paths = [[[120.182463,30.1814],[120.182639,30.177537],[120.188103,30.177301],[120.188337,30.181416],[120.185956,30.181349],[120.185956,30.181349]],[[120.216715,30.181286],[120.216709,30.181182],[120.216822,30.181181],[120.216819,30.181281]],[[120.181693,30.180703],[120.181699,30.180391],[120.18219,30.180407],[120.182123,30.180729]],[[120.169562,30.168156],[120.169644,30.167983],[120.16991,30.168054]],[[120.183411,30.149341],[120.183451,30.149126],[120.183936,30.149202],[120.183841,30.149393]],[[120.195185,30.185257],[120.195202,30.185049],[120.195494,30.185063],[120.195473,30.185253]],[[120.217526,30.208282],[120.21755,30.207609],[120.218391,30.207763],[120.218164,30.20849]],[[120.150896,30.161082],[120.15095,30.160971],[120.151858,30.161523],[120.151793,30.1616]],[[120.150456,30.333148],[120.150465,30.332989],[120.151151,30.333009],[120.151124,30.333164]],[[120.185514,30.348853],[120.185521,30.348738],[120.185636,30.348746],[120.185631,30.348858]],[[120.222486,30.193499],[120.222135,30.193489],[120.222146,30.193661],[120.222489,30.193653]],[[120.141859,30.175584],[120.141866,30.175804],[120.141535,30.175796],[120.141548,30.175583]],[[120.223913,30.19915],[120.223958,30.198901],[120.224388,30.198908],[120.22434,30.199157]],[[120.217216,30.188088],[120.217201,30.18827],[120.216734,30.188258],[120.216764,30.188059]],[[120.216967,30.181218],[120.216972,30.181097],[120.217189,30.181093],[120.217184,30.181204]],[[120.147244,30.190094],[120.147396,30.189832],[120.147476,30.189404],[120.148063,30.188696],[120.149135,30.188092],[120.149519,30.188805],[120.149469,30.190182],[120.148033,30.190365]],[[120.18505,30.183695],[120.185104,30.18323],[120.186348,30.183171],[120.186219,30.183761]],[[120.134236,30.174605],[120.134291,30.174138],[120.134813,30.174154],[120.134747,30.174601]],[[120.13519,30.174277],[120.135192,30.174168],[120.135295,30.174179],[120.135279,30.174275]],[[120.134408,30.175424],[120.134389,30.175497],[120.134479,30.175491],[120.134485,30.175439]],[[120.203039,30.165206],[120.203054,30.16502],[120.203371,30.165067],[120.20331,30.165261]]];
var p2Paths = [[[120.178604,30.181283],[120.178727,30.177557],[120.182339,30.177497],[120.182199,30.181328]],[[120.215828,30.181054],[120.215834,30.180581],[120.217391,30.180573],[120.217381,30.181074]],[[120.168174,30.168007],[120.17183,30.169152],[120.172881,30.167138],[120.168996,30.165775]],[[120.182469,30.149386],[120.18386,30.149545],[120.184692,30.148632],[120.185987,30.148183],[120.18669,30.146178],[120.183035,30.145149]],[[120.195063,30.185381],[120.195071,30.184892],[120.195667,30.184892],[120.195629,30.185403]],[[120.218259,30.208955],[120.218295,30.208332],[120.218659,30.20791],[120.220256,30.208349],[120.21953,30.20938]],[[120.149996,30.161398],[120.150573,30.160652],[120.151936,30.161409],[120.151687,30.161856],[120.150921,30.161482],[120.150643,30.161738]],[[120.185484,30.348934],[120.185527,30.348083],[120.18666,30.348129],[120.187048,30.348295],[120.187028,30.349]],[[120.149194,30.334685],[120.14971,30.332727],[120.151781,30.33278],[120.151637,30.334731]],[[120.219162,30.194593],[120.219229,30.192678],[120.223713,30.192574],[120.223638,30.194697]],[[120.141186,30.175405],[120.14124,30.175137],[120.141579,30.174813],[120.14177,30.174878],[120.141422,30.175447]],[[120.22362,30.200034],[120.223852,30.197688],[120.226205,30.197688],[120.226117,30.200102]],[[120.158626,30.169768],[120.1594,30.168052],[120.158819,30.167842],[120.160127,30.165393],[120.167391,30.167884],[120.165502,30.172008],[120.165502,30.172008],[120.165502,30.172008]],[[120.210999,30.187021],[120.210814,30.192216],[120.213688,30.193057],[120.215667,30.192523],[120.218005,30.192192],[120.217881,30.187039]],[[120.184819,30.185061],[120.18509,30.183803],[120.18618,30.18388],[120.185893,30.185232]],[[120.133942,30.175809],[120.134142,30.174756],[120.134963,30.174806],[120.134785,30.175929]],[[120.135528,30.174345],[120.135197,30.175928],[120.13494,30.175895],[120.135151,30.174377]],[[120.201164,30.165768],[120.20162,30.164857],[120.202163,30.164966],[120.20243,30.164123],[120.203737,30.164374],[120.203092,30.166583]]];
var p3Paths = [[[120.174382,30.181283],[120.174574,30.177557],[120.174574,30.177557],[120.178465,30.177633],[120.178325,30.181238]],[[120.210994,30.186786],[120.211486,30.176444],[120.221856,30.176291],[120.222112,30.18432],[120.221699,30.186242],[120.218117,30.186871]],[[120.167416,30.170026],[120.167633,30.17343],[120.173855,30.173187],[120.173777,30.171579],[120.176997,30.164823],[120.170234,30.162235],[120.167744,30.168003]],[[120.183717,30.155976],[120.182558,30.153007],[120.18215,30.14911],[120.18288,30.144915],[120.187387,30.146252],[120.194255,30.150112],[120.192667,30.151448],[120.192431,30.152636],[120.192581,30.15516],[120.191701,30.157424],[120.188524,30.155401]],[[120.192865,30.186494],[120.193272,30.184106],[120.196346,30.184106],[120.196176,30.186559]],[[120.216735,30.208919],[120.217155,30.204994],[120.223067,30.205629],[120.22043,30.210881]],[[120.143898,30.176235],[120.144996,30.176261],[120.146079,30.176768],[120.147282,30.171971],[120.148829,30.167719],[120.147581,30.167173],[120.145386,30.17162]],[[120.147725,30.167104],[120.148888,30.167593],[120.152336,30.161306],[120.150399,30.16038],[120.150399,30.16038],[120.148545,30.163134],[120.14779,30.164121],[120.148104,30.165489]],[[120.148584,30.337109],[120.149462,30.33261],[120.1519,30.332601],[120.152053,30.337391]],[[120.185525,30.347625],[120.186742,30.347645],[120.187996,30.348417],[120.18792,30.349832],[120.185423,30.349633]],[[120.184534,30.349869],[120.184564,30.34974],[120.18706,30.34991],[120.187042,30.350044]],[[120.218711,30.194684],[120.218831,30.192444],[120.223773,30.192224],[120.223728,30.194833]],[[120.139583,30.176097],[120.139553,30.174014],[120.142002,30.174514],[120.141958,30.176199],[120.141958,30.176199]],[[120.218416,30.196679],[120.218763,30.194956],[120.225902,30.195102],[120.225857,30.197556],[120.222048,30.197187]],[[120.154827,30.173406],[120.155722,30.170543],[120.158805,30.164384],[120.16195,30.165807],[120.167574,30.167608],[120.167199,30.173334]],[[120.182184,30.185903],[120.182444,30.181677],[120.188285,30.181677],[120.188407,30.186307],[120.188407,30.186307]],[[120.135239,30.17598],[120.135617,30.174266],[120.137518,30.174018],[120.139475,30.173994],[120.139458,30.176086]],[[120.145623,30.189879],[120.1459,30.188955],[120.145716,30.187723],[120.148302,30.18656],[120.148948,30.187769],[120.149508,30.189102],[120.149608,30.190346],[120.147748,30.190552]],[[120.200954,30.165767],[120.20255,30.1632],[120.207503,30.164219],[120.206422,30.168026],[120.20584,30.168097]]];

    map.setFitView();

    var polyList = [{
        editor: null,
        paths: p1Paths,
        fillColor: "#FF0000",
        polygons: [],
        printPrefix: "var p1Paths = ",
    }, {
        editor: null,
        paths: p2Paths,
        fillColor: "#FF6100",
        polygons: [],
        printPrefix: "var p2Paths = ",
    }, {
        editor: null,
        paths: p3Paths,
        fillColor: "#FFFF00",
        polygons: [],
        printPrefix: "var p3Paths = ",
    }];
    polyList.forEach(function (_, i) {
        var args = polyList[i];

        var polygons = [];
        args.polygons = polygons;

        var polyEditor = new AMap.PolygonEditor(map);
        args.editor = polyEditor;
        polyEditor.on('add', function (data) {
            var polygon = data.target;
            polyEditor.addAdsorbPolygons(polygon);
            polygons.push(polygon);
            polygon.on('dblclick', () => {
                polyEditor.setTarget(polygon);
                polyEditor.open();
            })
        })

        args.paths.forEach(function (p) {
            var polygon = new AMap.Polygon({
                path: p,
                fillColor: args.fillColor,
                fillOpacity: 0.3,
            });

            polygon.on('dblclick', () => {
                polyEditor.setTarget(polygon);
                polyEditor.open();
            })
            polygons.push(polygon);
        });
        map.add(polygons);
        polyEditor.addAdsorbPolygons(polygons);

    })

    function createPolygon(i) {
        var polyEditor = polyList[i].editor;
        polyEditor.close();
        polyEditor.setTarget();
        polyEditor.open();
    };

    function printPaths() {
        var msg = [];
        polyList.forEach(function(p) {
            var paths = [];
            p.polygons.forEach(function (polygon){
                if (polygon.getPath().length == 0) {
                    return
                }
                paths.push(polygon.getPath());
            });
            msg.push(p.printPrefix + JSON.stringify(paths) +";");
        });
        console.log(msg.join("\n"));
    }

    function closeEditor() {
        polyList.forEach(function(p) {
            p.editor.close();
        });
    }

</script>
</body>
</html>